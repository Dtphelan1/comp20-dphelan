<!DOCTYPE html>

<html>

        <head>
                <title>Dylan's Marauder's Map</title>
                <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
                <meta charset="utf-8" />
                <link rel="stylesheet" href="mmapStyle.css" />
                <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
                <script>
                        /* Map Data*/
                        var myLat = 0;
                        var myLng = 0;
                        var me = new google.maps.LatLng(myLat, myLng);
                        var map;
                        var mapOptions = {
                                zoom: 9,
                                center: me,
                                mapTypeId: google.maps.MapTypeId.ROADMAP
                        };
                        var marker;
                        var myMarkerOptions= {
                                title: "KyleBroflovski",
                                position: me
                        };
                        var infoWindow = new google.maps.InfoWindow();

                        /* Specifically XMLHttpRequest Data */
                        var request = new XMLHttpRequest();
                        var params;
                        var url = "http://chickenofthesea.herokuapp.com/sendLocation";
                        var userData;

                        /* Summary: Starts function calls to build entire map */
                        function init() {
                                map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
                                getMyLocation();
                        }

                        /* Summary: Using google maps API, obtains my lat and lng data */
                        function getMyLocation() {
                                if (navigator.geolocation) {
                                        navigator.geolocation.getCurrentPosition(function(position) {
                                                myLat = position.coords.latitude;
                                                myLng = position.coords.longitude;
                                                /* Make a marker for my location */
                                                makeMarker();
                                                makePost();
                                                });
                                } else {
                                        alert("Geolocation is not supported on your web browser -- cannot display map");
                                }
                        }

                        /* Summary: Makes a marker for my character */
                        function makeMarker() {
                                me = new google.maps.LatLng(myLat, myLng);
                                map.panTo(me);
                                myMarkerOptions.position = me;

                                marker = new google.maps.Marker(myMarkerOptions);
                                marker.setMap(map);
                        }

                        /* Summary: Makes a post to the heroku server with user information */ 
                        function makePost() { 
                                /* Build Params */
                                params = "login=" + myMarkerOptions.title + "&lat=" + myLat + "&lng=" + myLng;
                                request.open("POST", url, true);

                                request.setRequestHeader('Content-type','application/x-www-form-urlencoded');
                                request.onreadystatechange = function() {
                                        if(request.readyState == 4 && request.status == 200) {
                                                userData = JSON.parse(request.responseText);
                                                parseCharacters();
                                                parseStudents();
                                        }
                                };
                                request.send(params);
                        }

                        function parseCharacters() {
                                console.log(userData);
                                console.log(userData['characters'].length);

                        }

                        function parseStudents() {

                        }
                </script>
        </head>


        <body onload=init()>
                <div id="map_canvas"></div>
        </body>

</html>