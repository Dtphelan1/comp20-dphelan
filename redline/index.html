<!DOCTYPE html>

<html> 
    <head>
    <title> MBTA Fail </title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

    <link rel="stylesheet" href="styling.css" type="text/css" />

    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAjoxRk1gKr7r4mFBUZSjdTtXvw005k-5Y">
    </script>

    <script>
        // Variables that will be needed throughout rendering 
        var myLat = 0;
        var myLng = 0;
        var request = new XMLHttpRequest();
        var me = new google.maps.LatLng(myLat, myLng);

        var myOptions = {
                zoom: 13,
                center: me,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                };
        var map;
        var marker;
        var infoWindow = new google.maps.InfoWindow();
        var places;

        function init() {
                map = google.maps.Map(document.getElementById("map-canvas"), myOptions);
                getMyLocation();
        }

        function getMyLocation() {
                // If geolocation is enabled
                if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(function(position) {
                                myLat = position.coords.latitude;
                                myLng = position.coords.longitude;
                                renderMap();
                        });
                } else {
                        alert("Geolocation is not supported by your browser; we can't do anything");
                }
        }

        function renderMap() {
                me = new google.maps.LatLng(myLat, myLng);

                // Pan to location
                me.panTo(me);

                // Create a Marker
                marker = new google.maps.Marker({
                        position: me,
                        title: "Here I am"
                });
                marker.setMap(map);

                // Open info window when one clicks on marker
                google.maps.event.addListener(marker, 'click', function() {
                        infoWindow.setContent(marker.title);
                        infoWindow.open(map, marker);
                });
                
                // Calling Google Places API
                var request = {
                        location: me,
                        radius: '500',
                        types: ['food']
                };

                service = new google.maps.places.PlacesService(map);
                service.search(request, callback);
        }

        function callback(results, status) {
                if (status == google.maps.places.PlacesServiceStatus.OK) {
                        alert("Got places back!");
                        places = results;
                        for (var i = 0; i < results.length; i++) {
                                createMarker(results[i]);
                        }
                }
        }

        function createMarker(place) {
                var placeLoc = place.geometry.location;
                var marker = new google.maps.Marker({
                map: map,
                position: place.geometry.location
        });

        google.maps.event.addListener(marker, 'click', function() {
                infowindow.close();
                infowindow.setContent(place.name);
                infowindow.open(map, this);
        });
        }

    </script>
    </head>


    <body onload="init()">
            <div id="map-canvas"> </div> 
    </body> 
</html>
